- name: 🐳 Run in Arch container
  run: |
    docker run --rm -v $PWD:/workspace -w /workspace archlinux:latest bash -c '
      set -ex
      
      echo "--- Debug workspace ---"
      pwd
      ls -la
      
      echo "--- Initializing Pacman keyring ---"
      pacman-key --init
      pacman-key --populate archlinux
      
      echo "--- Updating system ---"
      pacman -Syu --noconfirm
      
      echo "--- Installing dependencies ---"
      pacman -S --noconfirm sudo git base-devel fish coreutils
      
      echo "--- Creating user ---"
      useradd -m sb74
      echo "sb74 ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers
      
      echo "--- Checking file before chmod ---"
      ls -la install.sh
      file install.sh
      
      echo "--- Making script executable ---"
      chmod +x install.sh
      
      echo "--- Checking file after chmod ---"
      ls -la install.sh
      
      echo "--- Running script ---"
      echo "y" | sudo -u sb74 env DRY_RUN=true CI=true ./install.sh
    '
