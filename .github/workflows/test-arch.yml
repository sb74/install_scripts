name: Test Arch Setup Script (Dry Run)

on:
 push:
   paths:
     - "install.sh"
     - ".github/workflows/*.yml"
     - ".github/workflows/*.yaml"
 pull_request:
   paths:
     - "install.sh"
     - ".github/workflows/*.yml"
     - ".github/workflows/*.yaml"

jobs:
 test-arch:
   name: 🧪 Dry Run on Arch Linux
   runs-on: ubuntu-latest

   container:
     image: archlinux:base

   steps:
     - name: 📥 Checkout repo
       uses: actions/checkout@v4

     - name: 🛠 Update system and install base tools
       run: |
         pacman -Syu --noconfirm
         pacman -S --noconfirm sudo git base-devel fish coreutils util-linux

     - name: 👤 Setup user
       run: |
         useradd -m -s /bin/bash sb74
         echo "sb74 ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers

     - name: 🔍 Debug and fix permissions
       run: |
         ls -la install.sh
         /bin/chmod +x install.sh
         ls -la install.sh

     - name: 🚀 Run setup script in DRY_RUN mode
       env:
         DRY_RUN: true
         CI: true
       run: |
         export DRY_RUN=true
         export CI=true
         sudo -E -u sb74 bash -c 'cd '"$PWD"' && echo "y" | ./install.sh'
